esphome:
  name: lcd-salon
  friendly_name: "LCD Salon"
  min_version: 2024.11.0
  project:
    name: "salon.lcd-salon"
    version: "3.2.4" # FEATURE: Powrót do Home (60s), Idle (30s)

  on_boot:
    priority: 600
    then:
      - light.turn_on: display_backlight

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password
  power_save_mode: none

api:
  encryption:
    key: "N2ZmNGExY2E3YjM0NmU1ZjhjOTBhMWIyYzNkNGU1ZjY="

logger:
  level: WARN

ota:
  - platform: esphome

safe_mode:

esp32:
  variant: esp32s3
  flash_size: 16MB
  framework:
    type: esp-idf
    advanced:
      execute_from_psram: true

psram:
  mode: octal
  speed: 80MHz

preferences:
  flash_write_interval: 5min

# ============================================================================
# ZMIENNE GLOBALNE
# ============================================================================
globals:
  - id: current_page_idx
    type: int
    restore_value: false
    initial_value: '0'

# ============================================================================
# MECHANIZM ODŚWIEŻANIA DANYCH
# ============================================================================
interval:
  - interval: 1s
    then:
      - lambda: |-
          lv_label_set_text(id(main_clock), id(ha_time).now().strftime("%H:%M").c_str());

  - interval: 0.5s
    then:
      - lambda: |-
          // --- STATUS BAR ---
          lv_label_set_text(id(status_wifi), id(wifi_icon_state).state.c_str());
          lv_label_set_text(id(status_wifi_p1), id(wifi_icon_state).state.c_str());
          lv_label_set_text(id(status_wifi_p2), id(wifi_icon_state).state.c_str());
          
          lv_label_set_text(id(status_battery), id(battery_icon_state).state.c_str());
          lv_label_set_text(id(status_battery_p1), id(battery_icon_state).state.c_str());
          lv_label_set_text(id(status_battery_p2), id(battery_icon_state).state.c_str());

          // --- NAWIGACJA (KOLORY) ---
          int page = id(current_page_idx);
          lv_color_t c_nav_active = lv_color_hex(0x0d70c1);
          lv_color_t c_nav_inactive = lv_color_hex(0xFFFFFF);

          lv_obj_set_style_text_color(id(nav_icon_0), (page == 0 ? c_nav_active : c_nav_inactive), 0);
          lv_obj_set_style_text_color(id(nav_icon_1), (page == 1 ? c_nav_active : c_nav_inactive), 0);
          lv_obj_set_style_text_color(id(nav_icon_2), (page == 2 ? c_nav_active : c_nav_inactive), 0);

          // --- PRZYCISKI (Page 1) ---
          lv_color_t c_row_off = lv_color_hex(0x2B374E);
          lv_color_t c_row_on  = lv_color_hex(0x0B73C6);
          lv_color_t c_btn_off = lv_color_hex(0x4C6594);
          lv_color_t c_btn_on  = lv_color_hex(0x1663A0);
          lv_color_t c_white    = lv_color_hex(0xFFFFFF);
          lv_color_t c_icon_off = lv_color_hex(0xB4B8BF);

          if (id(light_tv_state).state) {
            lv_obj_set_style_bg_color(id(row_tv), c_row_on, 0);
            lv_obj_set_style_bg_color(id(btn_tv), c_btn_on, 0);
            lv_obj_set_style_text_color(id(icon_bulb_tv), c_white, 0);
            lv_obj_set_style_text_color(id(lbl_tv_name), c_white, 0);
            lv_label_set_text(id(lbl_btn_tv), "\U000F0409 Włącz");
          } else {
            lv_obj_set_style_bg_color(id(row_tv), c_row_off, 0);
            lv_obj_set_style_bg_color(id(btn_tv), c_btn_off, 0);
            lv_obj_set_style_text_color(id(icon_bulb_tv), c_icon_off, 0);
            lv_obj_set_style_text_color(id(lbl_tv_name), c_white, 0);
            lv_label_set_text(id(lbl_btn_tv), "\U000F0409 Włącz");
          }

          if (id(light_couch_state).state) {
             lv_obj_set_style_bg_color(id(row_couch), c_row_on, 0);
             lv_obj_set_style_bg_color(id(btn_couch), c_btn_on, 0);
             lv_obj_set_style_text_color(id(icon_bulb_couch), c_white, 0);
             lv_obj_set_style_text_color(id(lbl_couch_name), c_white, 0);
             lv_label_set_text(id(lbl_btn_couch), "\U000F0409 Włącz");
          } else {
             lv_obj_set_style_bg_color(id(row_couch), c_row_off, 0);
             lv_obj_set_style_bg_color(id(btn_couch), c_btn_off, 0);
             lv_obj_set_style_text_color(id(icon_bulb_couch), c_icon_off, 0);
             lv_obj_set_style_text_color(id(lbl_couch_name), c_white, 0);
             lv_label_set_text(id(lbl_btn_couch), "\U000F0409 Włącz");
          }
          
          lv_label_set_text(id(main_date), id(ha_time).now().strftime("%d.%m.%Y").c_str());
          
          if (id(sensor_temp_salon).has_state()) {
            lv_label_set_text(id(label_temp_salon), str_sprintf("%.1f°C", id(sensor_temp_salon).state).c_str());
          } else { lv_label_set_text(id(label_temp_salon), "-"); }

          if (id(sensor_hum_salon).has_state()) {
            lv_label_set_text(id(label_hum_salon), str_sprintf("%.0f%%", id(sensor_hum_salon).state).c_str());
          } else { lv_label_set_text(id(label_hum_salon), "-"); }

          if (id(sensor_temp_ext).has_state()) {
            lv_label_set_text(id(label_temp_ext), str_sprintf("%.1f°C", id(sensor_temp_ext).state).c_str());
          } else { lv_label_set_text(id(label_temp_ext), "-"); }

          lv_label_set_text(id(weather_icon_main), id(weather_icon_current).state.c_str());

          if (id(sensor_woda).has_state()) {
            lv_label_set_text(id(val_water), str_sprintf("%.3f m³", id(sensor_woda).state).c_str());
          } else { lv_label_set_text(id(val_water), "--- m³"); }

          // PROGNOZA
          lv_label_set_text(id(label_day_0), id(day_name_0).state.c_str());
          lv_label_set_text(id(icon_day_0), id(icon_calculated_day_0).state.c_str());
          if (id(temp_day_0).has_state() && id(temp_low_day_0).has_state()) {
             lv_label_set_text(id(temp_day_0_label), str_sprintf("%.0f/%.0f", id(temp_day_0).state, id(temp_low_day_0).state).c_str());
          } else { lv_label_set_text(id(temp_day_0_label), "-"); }

          lv_label_set_text(id(label_day_1), id(day_name_1).state.c_str());
          lv_label_set_text(id(icon_day_1), id(icon_calculated_day_1).state.c_str());
          if (id(temp_day_1).has_state() && id(temp_low_day_1).has_state()) {
             lv_label_set_text(id(temp_day_1_label), str_sprintf("%.0f/%.0f", id(temp_day_1).state, id(temp_low_day_1).state).c_str());
          } else { lv_label_set_text(id(temp_day_1_label), "-"); }

          lv_label_set_text(id(label_day_2), id(day_name_2).state.c_str());
          lv_label_set_text(id(icon_day_2), id(icon_calculated_day_2).state.c_str());
          if (id(temp_day_2).has_state() && id(temp_low_day_2).has_state()) {
             lv_label_set_text(id(temp_day_2_label), str_sprintf("%.0f/%.0f", id(temp_day_2).state, id(temp_low_day_2).state).c_str());
          } else { lv_label_set_text(id(temp_day_2_label), "-"); }

          lv_label_set_text(id(label_day_3), id(day_name_3).state.c_str());
          lv_label_set_text(id(icon_day_3), id(icon_calculated_day_3).state.c_str());
          if (id(temp_day_3).has_state() && id(temp_low_day_3).has_state()) {
             lv_label_set_text(id(temp_day_3_label), str_sprintf("%.0f/%.0f", id(temp_day_3).state, id(temp_low_day_3).state).c_str());
          } else { lv_label_set_text(id(temp_day_3_label), "-"); }

          lv_label_set_text(id(label_day_4), id(day_name_4).state.c_str());
          lv_label_set_text(id(icon_day_4), id(icon_calculated_day_4).state.c_str());
          if (id(temp_day_4).has_state() && id(temp_low_day_4).has_state()) {
             lv_label_set_text(id(temp_day_4_label), str_sprintf("%.0f/%.0f", id(temp_day_4).state, id(temp_low_day_4).state).c_str());
          } else { lv_label_set_text(id(temp_day_4_label), "-"); }

# ============================================================================
# SENSORY
# ============================================================================
sensor:
  - platform: homeassistant
    id: sensor_temp_salon
    entity_id: sensor.temperatura_salon_temperature
  - platform: homeassistant
    id: sensor_hum_salon
    entity_id: sensor.temperatura_salon_humidity
  - platform: homeassistant
    id: sensor_temp_ext
    entity_id: sensor.temperatura_zewnetrzna_temperature
  
  - platform: homeassistant
    id: temp_day_0
    entity_id: sensor.weather_forecast_dom_high_temp_0
  - platform: homeassistant
    id: temp_day_1
    entity_id: sensor.weather_forecast_dom_high_temp_1
  - platform: homeassistant
    id: temp_day_2
    entity_id: sensor.weather_forecast_dom_high_temp_2
  - platform: homeassistant
    id: temp_day_3
    entity_id: sensor.weather_forecast_dom_high_temp_3
  - platform: homeassistant
    id: temp_day_4
    entity_id: sensor.weather_forecast_dom_high_temp_4

  - platform: homeassistant
    id: temp_low_day_0
    entity_id: sensor.weather_forecast_dom_low_temp_0
  - platform: homeassistant
    id: temp_low_day_1
    entity_id: sensor.weather_forecast_dom_low_temp_1
  - platform: homeassistant
    id: temp_low_day_2
    entity_id: sensor.weather_forecast_dom_low_temp_2
  - platform: homeassistant
    id: temp_low_day_3
    entity_id: sensor.weather_forecast_dom_low_temp_3
  - platform: homeassistant
    id: temp_low_day_4
    entity_id: sensor.weather_forecast_dom_low_temp_4

  - platform: homeassistant
    id: sensor_woda
    entity_id: sensor.wmbus_reader_v5_apator_water_meter_state
    internal: true

  - platform: adc
    pin: GPIO10
    id: internal_battery_voltage
    name: "Internal Battery"
    update_interval: 60s
    attenuation: 12db
    filters:
      - multiply: 2.0
    on_value:
      then:
        - component.update: battery_icon_state

  - platform: wifi_signal
    id: wifi_signal_dbm
    name: "WiFi Signal"
    update_interval: 60s
  - platform: uptime
    id: uptime_sensor
    name: "Uptime"

binary_sensor:
  - platform: homeassistant
    id: light_tv_state
    entity_id: light.lampka_pod_telewizorem
  - platform: homeassistant
    id: light_couch_state
    entity_id: light.lampka_przy_kanapie
  - platform: homeassistant
    id: gate_garage_state
    entity_id: switch.brama_garazowa

text_sensor:
  - platform: template
    id: day_name_0
    lambda: |-
      auto time = id(ha_time).now();
      if (!time.is_valid()) return {"-"};
      char buf[16];
      time.strftime(buf, sizeof(buf), "%a"); 
      return {buf};
    update_interval: 60s
  - platform: template
    id: day_name_1
    lambda: |-
      auto time = id(ha_time).now();
      if (!time.is_valid()) return {"-"};
      auto future = esphome::ESPTime::from_epoch_local(time.timestamp + 86400);
      char buf[16];
      future.strftime(buf, sizeof(buf), "%a");
      return {buf};
    update_interval: 60s
  - platform: template
    id: day_name_2
    lambda: |-
      auto time = id(ha_time).now();
      if (!time.is_valid()) return {"-"};
      auto future = esphome::ESPTime::from_epoch_local(time.timestamp + 172800);
      char buf[16];
      future.strftime(buf, sizeof(buf), "%a");
      return {buf};
    update_interval: 60s
  - platform: template
    id: day_name_3
    lambda: |-
      auto time = id(ha_time).now();
      if (!time.is_valid()) return {"-"};
      auto future = esphome::ESPTime::from_epoch_local(time.timestamp + 259200);
      char buf[16];
      future.strftime(buf, sizeof(buf), "%a");
      return {buf};
    update_interval: 60s
  - platform: template
    id: day_name_4
    lambda: |-
      auto time = id(ha_time).now();
      if (!time.is_valid()) return {"-"};
      auto future = esphome::ESPTime::from_epoch_local(time.timestamp + 345600);
      char buf[16];
      future.strftime(buf, sizeof(buf), "%a");
      return {buf};
    update_interval: 60s

  - platform: homeassistant
    id: condition_day_0
    entity_id: sensor.weather_forecast_dom_condition_0
  - platform: homeassistant
    id: condition_day_1
    entity_id: sensor.weather_forecast_dom_condition_1
  - platform: homeassistant
    id: condition_day_2
    entity_id: sensor.weather_forecast_dom_condition_2
  - platform: homeassistant
    id: condition_day_3
    entity_id: sensor.weather_forecast_dom_condition_3
  - platform: homeassistant
    id: condition_day_4
    entity_id: sensor.weather_forecast_dom_condition_4

  - platform: template
    id: icon_calculated_day_0
    update_interval: 10s
    lambda: |-
      if (!id(condition_day_0).has_state()) return {""}; 
      std::string s = id(condition_day_0).state;
      if (s == "clear-night" || s == "Clear-night") return {"\U000F0594"};
      if (s == "cloudy" || s == "Cloudy") return {"\U000F0590"};
      if (s == "fog" || s == "Fog") return {"\U000F0591"};
      if (s == "lightning" || s == "Lightning") return {"\U000F0593"};
      if (s == "partlycloudy" || s == "Partlycloudy") return {"\U000F0595"};
      if (s == "pouring" || s == "Pouring") return {"\U000F0596"};
      if (s == "rainy" || s == "Rainy") return {"\U000F0597"};
      if (s == "snowy" || s == "Snowy") return {"\U000F0598"};
      if (s == "sunny" || s == "Sunny") return {"\U000F0599"};
      if (s == "windy" || s == "Windy") return {"\U000F059D"};
      return {"\U000F0599"};

  - platform: template
    id: icon_calculated_day_1
    update_interval: 10s
    lambda: |-
      if (!id(condition_day_1).has_state()) return {""};
      std::string s = id(condition_day_1).state;
      if (s == "clear-night" || s == "Clear-night") return {"\U000F0594"};
      if (s == "cloudy" || s == "Cloudy") return {"\U000F0590"};
      if (s == "fog" || s == "Fog") return {"\U000F0591"};
      if (s == "lightning" || s == "Lightning") return {"\U000F0593"};
      if (s == "partlycloudy" || s == "Partlycloudy") return {"\U000F0595"};
      if (s == "pouring" || s == "Pouring") return {"\U000F0596"};
      if (s == "rainy" || s == "Rainy") return {"\U000F0597"};
      if (s == "snowy" || s == "Snowy") return {"\U000F0598"};
      if (s == "sunny" || s == "Sunny") return {"\U000F0599"};
      if (s == "windy" || s == "Windy") return {"\U000F059D"};
      return {"\U000F0599"};
  
  - platform: template
    id: icon_calculated_day_2
    update_interval: 10s
    lambda: |-
      if (!id(condition_day_2).has_state()) return {""};
      std::string s = id(condition_day_2).state;
      if (s == "clear-night" || s == "Clear-night") return {"\U000F0594"};
      if (s == "cloudy" || s == "Cloudy") return {"\U000F0590"};
      if (s == "fog" || s == "Fog") return {"\U000F0591"};
      if (s == "lightning" || s == "Lightning") return {"\U000F0593"};
      if (s == "partlycloudy" || s == "Partlycloudy") return {"\U000F0595"};
      if (s == "pouring" || s == "Pouring") return {"\U000F0596"};
      if (s == "rainy" || s == "Rainy") return {"\U000F0597"};
      if (s == "snowy" || s == "Snowy") return {"\U000F0598"};
      if (s == "sunny" || s == "Sunny") return {"\U000F0599"};
      if (s == "windy" || s == "Windy") return {"\U000F059D"};
      return {"\U000F0599"};

  - platform: template
    id: icon_calculated_day_3
    update_interval: 10s
    lambda: |-
      if (!id(condition_day_3).has_state()) return {""};
      std::string s = id(condition_day_3).state;
      if (s == "clear-night" || s == "Clear-night") return {"\U000F0594"};
      if (s == "cloudy" || s == "Cloudy") return {"\U000F0590"};
      if (s == "fog" || s == "Fog") return {"\U000F0591"};
      if (s == "lightning" || s == "Lightning") return {"\U000F0593"};
      if (s == "partlycloudy" || s == "Partlycloudy") return {"\U000F0595"};
      if (s == "pouring" || s == "Pouring") return {"\U000F0596"};
      if (s == "rainy" || s == "Rainy") return {"\U000F0597"};
      if (s == "snowy" || s == "Snowy") return {"\U000F0598"};
      if (s == "sunny" || s == "Sunny") return {"\U000F0599"};
      if (s == "windy" || s == "Windy") return {"\U000F059D"};
      return {"\U000F0599"};

  - platform: template
    id: icon_calculated_day_4
    update_interval: 10s
    lambda: |-
      if (!id(condition_day_4).has_state()) return {""};
      std::string s = id(condition_day_4).state;
      if (s == "clear-night" || s == "Clear-night") return {"\U000F0594"};
      if (s == "cloudy" || s == "Cloudy") return {"\U000F0590"};
      if (s == "fog" || s == "Fog") return {"\U000F0591"};
      if (s == "lightning" || s == "Lightning") return {"\U000F0593"};
      if (s == "partlycloudy" || s == "Partlycloudy") return {"\U000F0595"};
      if (s == "pouring" || s == "Pouring") return {"\U000F0596"};
      if (s == "rainy" || s == "Rainy") return {"\U000F0597"};
      if (s == "snowy" || s == "Snowy") return {"\U000F0598"};
      if (s == "sunny" || s == "Sunny") return {"\U000F0599"};
      if (s == "windy" || s == "Windy") return {"\U000F059D"};
      return {"\U000F0599"};

  - platform: homeassistant
    id: weather_condition
    entity_id: weather.forecast_dom
  
  - platform: template
    id: weather_icon_current
    update_interval: 60s
    lambda: |-
      if (!id(weather_condition).has_state()) return {"\U000F0599"};
      std::string state = id(weather_condition).state;
      if (state == "clear-night") return {"\U000F0594"};
      if (state == "cloudy") return {"\U000F0590"};
      if (state == "fog") return {"\U000F0591"};
      if (state == "lightning") return {"\U000F0593"};
      if (state == "partly-cloudy") return {"\U000F0595"};
      if (state == "partlycloudy") return {"\U000F0595"};
      if (state == "pouring") return {"\U000F0596"};
      if (state == "rainy") return {"\U000F0597"};
      if (state == "snowy") return {"\U000F0598"};
      if (state == "sunny") return {"\U000F0599"};
      if (state == "windy") return {"\U000F059D"};
      return {"\U000F0599"};

  - platform: template
    id: wifi_icon_state
    update_interval: 10s
    lambda: |-
      if (!id(wifi_signal_dbm).has_state()) return {"\U000F0925"}; 
      if (id(wifi_signal_dbm).state > -60) return {"\U000F0928"};
      if (id(wifi_signal_dbm).state > -80) return {"\U000F0922"};
      return {"\U000F0925"};

  - platform: template
    id: battery_icon_state
    update_interval: 60s
    lambda: |-
      if (!id(internal_battery_voltage).has_state()) return {"\U000F0083"}; 
      float v = id(internal_battery_voltage).state;
      if (v >= 4.5) return {"\U000F0A09"};
      if (v >= 4.0) return {"\U000F0082"};
      if (v >= 3.8) return {"\U000F0081"};
      if (v >= 3.6) return {"\U000F0089"};
      if (v >= 3.4) return {"\U000F008C"};
      return {"\U000F0083"};

# ============================================================================
# SPRZĘT
# ============================================================================
spi:
  - id: qspi_bus
    type: quad
    clk_pin: GPIO47
    data_pins: [21, 48, 40, 39]

i2c:
  - id: bus_a
    sda: GPIO4
    scl: GPIO8
    scan: true

output:
  - platform: ledc
    pin: GPIO1
    id: gpio_backlight_pwm
    frequency: 1200Hz

light:
  - platform: monochromatic
    output: gpio_backlight_pwm
    name: Display Backlight
    id: display_backlight
    restore_mode: ALWAYS_ON

touchscreen:
  - platform: axs15231
    id: my_touchscreen
    i2c_id: bus_a
    transform:
      swap_xy: false
      mirror_x: false
      mirror_y: false
    on_touch:
      - light.turn_on:
          id: display_backlight
          brightness: 100%
          transition_length: 0.2s

display:
  - id: my_display
    platform: qspi_dbi
    spi_id: qspi_bus
    dimensions:
      height: 480
      width: 320
      offset_height: 0
      offset_width: 0
    model: CUSTOM
    data_rate: 40MHz
    cs_pin:
      number: 45
      ignore_strapping_warning: true
    draw_from_origin: true
    update_interval: 5s
    auto_clear_enabled: false

time:
  - platform: homeassistant
    id: ha_time

# ============================================================================
# CZCIONKI
# ============================================================================
font:
  - file: "gfonts://Roboto"
    id: font_roboto_14
    size: 14
    glyphs: ' !"#$%&''()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\]^_`abcdefghijklmnopqrstuvwxyz{|}~ĄĆĘŁŃÓŚŹŻąćęłńóśźż'
  - file:
      type: gfonts
      family: Roboto
      weight: 700
    id: font_roboto_700_14
    size: 14
    glyphs: '0123456789., m³'
  - file:
      type: gfonts
      family: Roboto
      weight: 700
    id: font_roboto_34
    size: 34
    glyphs: '0123456789.:%°C ,-na'
  - file: "gfonts://Roboto"
    id: font_roboto_12
    size: 12
    glyphs: ' !"#$%&''()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\]^_`abcdefghijklmnopqrstuvwxyz{|}~ĄĆĘŁŃÓŚŹŻąćęłńóśźż°'
  - file:
      type: gfonts
      family: Roboto
      weight: 700
    id: font_roboto_28
    size: 28
    glyphs: '0123456789.:%°C,-na'
  - file:
      type: gfonts
      family: Roboto
      weight: 700
    id: font_roboto_10
    size: 10
    glyphs: 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZĄĆĘŁŃÓŚŹŻąćęłńóśźż-.'
  - file:
      type: gfonts
      family: Roboto
      weight: 700
    id: font_roboto_700_16
    size: 16
    glyphs: '0123456789., m³-'
  
  # IKONY
  - file: materialdesignicons-webfont.ttf
    id: font_mdi_60
    size: 60
    glyphs: ["\U000F0594", "\U000F0590", "\U000F0591", "\U000F0593", "\U000F067E", "\U000F0595", "\U000F0596", "\U000F0597", "\U000F0598", "\U000F0599", "\U000F059D", "\U000F0335"]
  - file: materialdesignicons-webfont.ttf
    id: font_mdi_24
    size: 24
    glyphs: 
      - "\U000F0594" # clear-night
      - "\U000F0590" # cloudy
      - "\U000F0591" # fog
      - "\U000F0593" # lightning
      - "\U000F067E" # lightning-rainy
      - "\U000F0595" # partlycloudy
      - "\U000F0596" # pouring
      - "\U000F0597" # rainy
      - "\U000F0598" # snowy
      - "\U000F0599" # sunny
      - "\U000F059D" # windy
      - "\U000F05A9" # wifi
      - "\U000F0083" # battery-alert
      - "\U000F0141" # arrow-left
      - "\U000F0142" # arrow-right
      - "\U000F02DC" # home (DOM)
      - "\U000F1534" # wifi-off
      - "\U000F0928" # wifi-strength-4
      - "\U000F0922" # wifi-strength-2
      - "\U000F0925" # wifi-strength-3
      - "\U000F0082" # battery-90
      - "\U000F0089" # battery-50
      - "\U000F0081" # battery-70
      - "\U000F008C" # battery-20
      - "\U000F0A09" # power-plug
      - "\U000F0409" # power
      - "\U000F0335" # lamp
      - "\U000F10B1" # mdi-button-pointer
      - "\U000F0FB6" # mdi-file-star-four-points-outline

# ============================================================================
# KOLORY
# ============================================================================
color:
  - id: c_white
    hex: "FFFFFF"
  - id: c_bg_main
    hex: "242E42"
  - id: c_bg_card
    hex: "2e3b53"
  - id: c_row_off
    hex: "2B374E"
  - id: c_row_on
    hex: "0B73C6"
  - id: c_btn_off
    hex: "4C6594"
  - id: c_btn_on
    hex: "1663A0"
  - id: c_circle
    hex: "424C5E"
  - id: c_icon_off
    hex: "B4B8BF"
  - id: c_readings_bg
    hex: "2B374E"
  - id: c_line_sep
    hex: "6B7383"
  - id: c_nav_active
    hex: "0d70c1"

# ============================================================================
# LVGL
# ============================================================================
lvgl:
  id: my_lvgl
  log_level: WARN
  bg_color: c_white
  displays: my_display
  touchscreens: my_touchscreen
  
  on_idle:
    # ŚCIEMNIANIE PO 30 SEKUNDACH
    - timeout: 30s
      then:
        - lambda: |-
            auto time = id(ha_time).now();
            if (time.is_valid()) {
              if (time.hour >= 23 || time.hour < 7) {
                id(display_backlight).turn_on().set_brightness(0.15).perform();
              } else {
                id(display_backlight).turn_on().set_brightness(0.30).perform();
              }
            } else {
              id(display_backlight).turn_on().set_brightness(0.30).perform();
            }

    # POWRÓT DO HOME PO 60 SEKUNDACH
    - timeout: 60s
      then:
        - lvgl.page.show: page_0
        - globals.set:
            id: current_page_idx
            value: '0'

  pages:
    - id: page_0
      widgets:
        - obj:
            scrollable: false
            x: 0
            y: 0
            width: 320
            height: 480
            bg_color: c_bg_main
            bg_opa: COVER
            border_width: 0
            radius: 0
            scrollbar_mode: "OFF"
        - label:
            id: status_wifi
            x: 280
            y: 5
            text_font: font_mdi_24
            text_color: c_white
            align: TOP_LEFT
            text: "-"
        - label:
            id: status_battery
            x: 250
            y: 5
            text_font: font_mdi_24
            text_color: c_white
            align: TOP_LEFT
            text: "-"
        - obj:
            scrollable: false
            x: 10
            y: 53
            width: 300
            height: 84
            bg_color: c_bg_card
            radius: 20
            border_width: 0
            scrollbar_mode: "OFF"
            widgets:
              - label:
                  id: main_clock
                  align: CENTER
                  y: -12
                  text_font: font_roboto_34
                  text_color: c_white
                  text: "00:00"
              - label:
                  id: main_date
                  align: CENTER
                  y: 18
                  text_font: font_roboto_14
                  text_color: c_white
                  text: "01.01.2024"
        - obj:
            scrollable: false
            x: 10
            y: 148
            width: 144
            height: 84
            bg_color: c_bg_card
            radius: 20
            border_width: 0
            scrollbar_mode: "OFF"
            widgets:
              - label:
                  align: TOP_MID
                  y: 5
                  text: "Temperatura"
                  text_font: font_roboto_12
                  text_color: c_white
              - label:
                  id: label_temp_salon
                  align: CENTER
                  y: 10
                  text_font: font_roboto_34
                  text_color: c_white
                  text: "-"
        - obj:
            scrollable: false
            x: 165
            y: 148
            width: 144
            height: 84
            bg_color: c_bg_card
            radius: 20
            border_width: 0
            scrollbar_mode: "OFF"
            widgets:
              - label:
                  align: TOP_MID
                  y: 5
                  text: "Wilgotność"
                  text_font: font_roboto_12
                  text_color: c_white
              - label:
                  id: label_hum_salon
                  align: CENTER
                  y: 10
                  text_font: font_roboto_34
                  text_color: c_white
                  text: "-"
        - obj:
            scrollable: false
            x: 10
            y: 243
            width: 300
            height: 77
            bg_color: c_bg_card
            radius: 20
            border_width: 0
            scrollbar_mode: "OFF"
            widgets:
              - label:
                  id: weather_icon_main
                  x: 35
                  y: 3
                  align: LEFT_MID
                  text_font: font_mdi_60
                  text_color: c_white
                  text: "\U000F0599"
              - label:
                  x: 110
                  y: -18
                  align: LEFT_MID
                  text: "Temperatura Zewnętrzna"
                  text_font: font_roboto_12
                  text_color: c_white
              - label:
                  id: label_temp_ext
                  x: 110
                  y: 12
                  align: LEFT_MID
                  text_font: font_roboto_28
                  text_color: c_white
                  text: "-"
        - obj:
            scrollable: false
            x: 10
            y: 331
            width: 300
            height: 84
            bg_color: c_bg_card
            radius: 20
            border_width: 0
            scrollbar_mode: "OFF"
            widgets:
              - obj:
                  scrollable: false
                  width: 100%
                  height: 100%
                  bg_opa: 0%
                  border_width: 0
                  pad_all: 0
                  scrollbar_mode: "OFF"
                  layout:
                    type: flex
                    flex_flow: ROW
                    flex_align_main: SPACE_EVENLY
                    flex_align_cross: CENTER
                  widgets:
                    - obj: &forecast_day
                        scrollable: false
                        width: 50
                        height: 100%
                        bg_opa: 0%
                        border_width: 0
                        pad_all: 0
                        widgets:
                          - label:
                              id: label_day_0
                              align: TOP_MID
                              y: 0 
                              text_font: font_roboto_12
                              text_color: c_white
                              text: "-"
                          - label:
                              id: icon_day_0
                              align: CENTER
                              y: 0
                              text_font: font_mdi_24
                              text_color: c_white
                              text: "-"
                          - label:
                              id: temp_day_0_label
                              align: BOTTOM_MID
                              y: -2
                              text_font: font_roboto_12
                              text_color: c_white
                              text: "-"
                    - obj:
                        <<: *forecast_day
                        widgets:
                          - label: {id: label_day_1, align: TOP_MID, y: 0, text_font: font_roboto_12, text_color: c_white}
                          - label: {id: icon_day_1, align: CENTER, y: 0, text_font: font_mdi_24, text_color: c_white}
                          - label: {id: temp_day_1_label, align: BOTTOM_MID, y: -2, text_font: font_roboto_12, text_color: c_white}
                    - obj:
                        <<: *forecast_day
                        widgets:
                          - label: {id: label_day_2, align: TOP_MID, y: 0, text_font: font_roboto_12, text_color: c_white}
                          - label: {id: icon_day_2, align: CENTER, y: 0, text_font: font_mdi_24, text_color: c_white}
                          - label: {id: temp_day_2_label, align: BOTTOM_MID, y: -2, text_font: font_roboto_12, text_color: c_white}
                    - obj:
                        <<: *forecast_day
                        widgets:
                          - label: {id: label_day_3, align: TOP_MID, y: 0, text_font: font_roboto_12, text_color: c_white}
                          - label: {id: icon_day_3, align: CENTER, y: 0, text_font: font_mdi_24, text_color: c_white}
                          - label: {id: temp_day_3_label, align: BOTTOM_MID, y: -2, text_font: font_roboto_12, text_color: c_white}
                    - obj:
                        <<: *forecast_day
                        widgets:
                          - label: {id: label_day_4, align: TOP_MID, y: 0, text_font: font_roboto_12, text_color: c_white}
                          - label: {id: icon_day_4, align: CENTER, y: 0, text_font: font_mdi_24, text_color: c_white}
                          - label: {id: temp_day_4_label, align: BOTTOM_MID, y: -2, text_font: font_roboto_12, text_color: c_white}

    - id: page_1
      widgets:
        - obj:
            scrollable: false
            x: 0
            y: 0
            width: 320
            height: 480
            bg_color: c_bg_main
            bg_opa: COVER
            border_width: 0
            radius: 0
            scrollbar_mode: "OFF"
        - label:
            id: status_wifi_p1
            x: 280
            y: 5
            text_font: font_mdi_24
            text_color: c_white
            align: TOP_LEFT
            text: "-"
        - label:
            id: status_battery_p1
            x: 250
            y: 5
            text_font: font_mdi_24
            text_color: c_white
            align: TOP_LEFT
            text: "-"
        - obj:
            id: row_tv
            x: 10
            y: 53
            width: 300
            height: 50
            bg_color: c_row_off
            radius: 15
            widgets:
              - obj:
                  x: 10
                  y: 5
                  width: 40
                  height: 40
                  bg_color: c_circle
                  radius: 20
                  widgets:
                    - label: {id: icon_bulb_tv, align: CENTER, text: "\U000F0335", text_font: font_mdi_24, text_color: c_icon_off}
              - label: {id: lbl_tv_name, x: 60, y: 0, align: LEFT_MID, text: "Lampka TV", text_font: font_roboto_14, text_color: c_white}
              - button:
                  id: btn_tv
                  x: 204
                  y: 5
                  width: 90
                  height: 40
                  bg_color: c_btn_off
                  radius: 5
                  on_click:
                     - homeassistant.service:
                        service: light.toggle
                        data: { entity_id: light.lampka_pod_telewizorem }
                  widgets:
                    - label: {id: lbl_btn_tv, align: CENTER, text: "\U000F0409 Włącz", text_font: font_roboto_12, text_color: c_white}
        - obj:
            id: row_couch
            x: 10
            y: 113
            width: 300
            height: 50
            bg_color: c_row_off
            radius: 15
            widgets:
              - obj:
                  x: 10
                  y: 5
                  width: 40
                  height: 40
                  bg_color: c_circle
                  radius: 20
                  widgets:
                    - label: {id: icon_bulb_couch, align: CENTER, text: "\U000F0335", text_font: font_mdi_24, text_color: c_icon_off}
              - label: {id: lbl_couch_name, x: 60, y: 0, align: LEFT_MID, text: "Lampka Kanapa", text_font: font_roboto_14, text_color: c_white}
              - button:
                  id: btn_couch
                  x: 204
                  y: 5
                  width: 90
                  height: 40
                  bg_color: c_btn_off
                  on_click:
                     - homeassistant.service:
                        service: light.toggle
                        data: { entity_id: light.lampka_przy_kanapie }
                  widgets:
                    - label: {id: lbl_btn_couch, align: CENTER, text: "\U000F0409 Włącz", text_font: font_roboto_12, text_color: c_white}

    - id: page_2
      widgets:
        - obj:
            scrollable: false
            x: 0
            y: 0
            width: 320
            height: 480
            bg_color: c_bg_main
            bg_opa: COVER
            scrollbar_mode: "OFF"
        - label: {id: status_wifi_p2, x: 280, y: 5, text_font: font_mdi_24, text_color: c_white, align: TOP_LEFT, text: "-"}
        - label: {id: status_battery_p2, x: 250, y: 5, text_font: font_mdi_24, text_color: c_white, align: TOP_LEFT, text: "-"}
        - obj:
            id: table_container
            x: 10
            y: 50
            width: 300
            height: 230
            radius: 15
            bg_color: c_readings_bg
            widgets:
              - label: {x: 10, y: 10, text: "Wodomierz", text_font: font_roboto_14, text_color: c_white, align: TOP_LEFT}
              - label: {id: val_water, x: -10, y: 10, text: "--- m³", text_font: font_roboto_700_14, text_color: c_white, align: TOP_RIGHT}
              - line:
                  x: 40
                  y: 40
                  points: ["0, 0", "220, 0"]
                  line_width: 1
                  line_color: c_line_sep

  top_layer:
    widgets:
      - obj:
          scrollable: false
          x: 0
          y: 420
          width: 320
          height: 60
          bg_color: c_bg_main
          bg_opa: COVER
          layout:
            type: flex
            flex_flow: ROW
            flex_align_main: SPACE_EVENLY
            flex_align_cross: CENTER
          widgets:
            - button:
                width: 80
                height: 50
                bg_opa: 0%
                on_click:
                  - globals.set: {id: current_page_idx, value: '0'}
                  - lvgl.page.show: page_0
                widgets:
                  - label: {id: nav_icon_0, align: CENTER, text: "\U000F02DC", text_font: font_mdi_24, text_color: c_white}
            - button:
                width: 80
                height: 50
                bg_opa: 0%
                on_click:
                  - globals.set: {id: current_page_idx, value: '1'}
                  - lvgl.page.show: page_1
                widgets:
                  - label: {id: nav_icon_1, align: CENTER, text: "\U000F10B1", text_font: font_mdi_24, text_color: c_white}
            - button:
                width: 80
                height: 50
                bg_opa: 0%
                on_click:
                  - globals.set: {id: current_page_idx, value: '2'}
                  - lvgl.page.show: page_2
                widgets:
                  - label: {id: nav_icon_2, align: CENTER, text: "\U000F0FB6", text_font: font_mdi_24, text_color: c_white}